jQuery(document).ready(function(){jQuery("input.text.googleaddress").each(function(h,a){GoogleAddressFieldInstatiator.init(jQuery(a))});GoogleAddressFieldInstatiator.attachInCMS()});
var GoogleAddressFieldInstatiator={init:function(h){h.each(function(){if("done"!==jQuery(this).attr("data-instantiated")){var a=jQuery(this).data();a.name=jQuery(this).attr("name");jQuery(this).attr("data-instantiated","done");var b=new GoogleAddressField(a.name),c;for(c in a){if("relatedfields"===c)var d=a[c].replace(/&quot;/g,'"'),d=JSON.parse(d);else d=a[c];"false"===d&&(d=!1);"true"===d&&(d=!0);a.hasOwnProperty(c)&&b.setVar(c,d)}b.init()}})},attachInCMS:function(){"undefined"!==typeof jQuery.entwine&&
jQuery.entwine(function(h){h("input.text.googleaddress").entwine({onmatch:function(){h("input.text.googleaddress").each(function(a,b){GoogleAddressFieldInstatiator.init(h(b))})}})})}},GoogleAddressField=function(h){var a={debug:!1,defaultAddress:"",fieldName:h,entryField:null,entryFieldHolder:null,entryFieldRightLabel:null,entryFieldLeftLabel:null,useSensor:!1,autocomplete:null,relatedFields:{},alwaysShowFields:!0,findNewAddressText:"",errorMessageMoreSpecific:"",selectedOptionNotAllowed:"",errorMessageAddressNotFound:"",
hasTextClass:"hasText",useMeClass:"useMe",selectedClass:"selected",bypassSelector:"a.bypassGoogleGeocoding",returnSelector:"a.returnGoogleGeocoding",viewGoogleMapLinkSelector:"a.viewGoogleMapLink",classForUncompletedField:"holder-required",googleStaticMapLink:"",defaultWidthOfStaticImage:300,defaultHeightOfStaticImage:300,urlForViewGoogleMapLink:"http://maps.google.com/maps/search/",linkLabelToViewMap:"View Map",percentageToBeCompleted:.25,typeToBeReturned:"address",restrictToCountryCode:"",init:function(){if("undefined"===
typeof google)console.debug("google map library is not loaded!"),jQuery(".field.googleaddress").hide(),this.alwaysShowFields=!0;else{a.entryField=jQuery('input[name="'+a.fieldName+'"]');a.entryFieldHolder=jQuery(a.entryField).closest("div.field");a.entryFieldRightLabel=a.entryFieldHolder.find("label.right");a.entryFieldLeftLabel=a.entryFieldHolder.find("label.left");var b="#"+a.entryFieldHolder.attr("ID")+" "+a.returnSelector,b=jQuery(b);a.hideFields();a.setResults("no");a.updateEntryFieldStatus();
var c=a.entryField.attr("id"),d={types:[a.typeToBeReturned]};a.restrictToCountryCode&&(d.componentRestrictions={country:a.restrictToCountryCode});c=document.getElementById(c);a.autocomplete=new google.maps.places.Autocomplete(c,d);google.maps.event.addListener(a.autocomplete,"place_changed",function(){a.fillInAddress()});a.entryField.focusin(function(){a.hideFields();a.useSensor&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(b){b=new google.maps.LatLng(b.coords.latitude,
b.coords.longitude);a.autocomplete.setBounds(new google.maps.LatLngBounds(b,b))});a.updateEntryFieldStatus()}).focusout(function(){a.hasResults()&&a.showFields();a.updateEntryFieldStatus()}).keypress(function(a){if(13==a.which)return!1}).on("input propertychange paste",function(b){a.hasResults()&&(a.clearFields(),a.setResults("no"),a.updateEntryFieldStatus())});(function(a){function b(d,k){if("keydown"==d){var f=k;k=function(b){var c=0<jQuery(".pac-item-selected").length;13!=b.which||c||(c=jQuery.Event("keydown",
{keyCode:40,which:40}),f.apply(a,[c]));f.apply(a,[b])}}c.apply(a,[d,k])}var c=a.addEventListener?a.addEventListener:a.attachEvent;a.addEventListener=b;a.attachEvent=b})(c);a.entryFieldHolder.find(a.bypassSelector).click(function(b){b.preventDefault();a.showFields();a.entryFieldHolder.hide();return!1});jQuery(b).click(function(b){b.preventDefault();a.hideFields();a.entryFieldHolder.show();return!1});a.alreadyHasValues()&&!a.entryFieldHolder.is(":hidden")&&(a.showFields(),a.entryFieldLeftLabel.text(a.findNewAddressText));
a.entryFieldHolder.find(a.viewGoogleMapLinkSelector).attr("target","_googleMap");0<a.entryField.val().length&&(a.entryField.attr("placeholder",a.entryField.val()),a.entryField.val(""));"string"===typeof a.defaultAddress&&0<a.defaultAddress.length&&(a.loadDefaultAddress(),a.entryField.val(a.defaultAddress));jQuery(a.entryField).closest("form").on("click","input[type=submit]",function(b){a.showFields()})}},fillInAddress:function(){if("undefined"===typeof b)var b=a.autocomplete.getPlace();a.entryField.attr("data-has-result",
"no");a.debug&&console.log(b);var c=!1;if("undefined"!==typeof b){var d=b.address_components;"undefined"===typeof d&&(d=b.types);"undefined"!==typeof d&&(c=!0);d=a.entryFieldHolder.find(a.viewGoogleMapLinkSelector);if(c)if(c=encodeURIComponent(b.formatted_address),d.attr("href",a.urlForViewGoogleMapLink+c),(c=a.getStaticMapImage(c))?d.html('<img src="'+c+'" alt="Google Map" />'):d.html(a.linkLabelToViewMap),b&&b.address_components){b.address_components.push({long_name:b.formatted_address,short_name:b.formatted_address,
types:["formatted_address"]});for(var e in a.relatedFields){if(a.relatedFields.hasOwnProperty(e))if(d=[],c=jQuery("input[name='"+e+"'],select[name='"+e+"'],textarea[name='"+e+"']"),jQuery(c).closest("div.field"),0<c.length){c.show().val("");a.debug&&console.debug("- checking form field: "+e+" now searching for data ...");for(var k=0;k<b.address_components.length;k++){a.debug&&console.debug("- -----  ----- ----- provided information: "+b.address_components[k].long_name);for(var h=0;h<b.address_components[k].types.length;h++){var l=
b.address_components[k].types[h];a.debug&&console.debug("- ----- ----- ----- ----- ----- ----- found Google Info for: "+l);for(var m in a.relatedFields[e])if(a.relatedFields[e].hasOwnProperty(m)&&(a.debug&&console.debug("- ----- ----- ----- ----- ----- ----- ----- ----- ----- with form field checking: "+m+" is the same as google type: "+l),m==l)){var f=a.relatedFields[e][m],g=b.address_components[k][f];if(-1==jQuery.inArray(g,d)){d.push(g);a.debug&&console.debug("- ***** ***** ***** ***** ***** ***** ***** ***** ***** ***** ***** ***** setting: "+
e+" to "+g+", using "+f+" in google address");f="";g=g.trim();"subpremise"==l&&(g+="/");c.is("input")&&(f=jQuery('input[name="'+e+'"]').val(),g=f+" "+g);c.is("textarea")&&(f=jQuery('textarea[name="'+e+'"]').val(),g=f+" "+g);if(c.is("select")){var n=!1;$(c).find("option").each(function(){jQuery(this).val()==g&&(n=!0)});n||(f=jQuery(c).attr("id"),f=jQuery('label[for="'+f+'"'),f=jQuery(f).text(),alert(a.selectedOptionNotAllowed+" "+f+"."),jQuery(c).focus())}c.val(g.trim());a.setResults("yes")}else a.debug&&
console.debug("- ----- ----- ----- ----- ----- ----- ----- ----- ----- data already used: "+g)}}}}else a.debug&&console.debug("E -----  ----- ----- could not find form field with ID: #"+e+"");a.entryFieldLeftLabel.text(a.findNewAddressText)}}else a.entryField.val(a.errorMessageAddressNotFound);else a.entryField.val(a.errorMessageMoreSpecific),d.attr("href",a.urlForViewGoogleMapLink).html("");a.updateEntryFieldStatus();a.hasResults()&&a.showFields()}},showFields:function(){for(var b in a.relatedFields){var c=
jQuery("input[name='"+b+"'],select[name='"+b+"'],textarea[name='"+b+"']"),d=jQuery(c).closest("div.field");"hidden"!==c.attr("type")&&(d.removeClass("hide").addClass("show"),d.find("select[data-has-required='yes'], input[data-has-required='yes']").each(function(a,b){jQuery(b).attr("required","required").removeAttr("data-has-required")}))}a.entryField.removeAttr("required");a.entryFieldHolder.removeAttr("required");jQuery(a.entryFieldHolder).prev().show()},hideFields:function(){if(!0!==this.alwaysShowFields){var b=
!1,c;for(c in a.relatedFields){var d=jQuery("input[name='"+c+"'],select[name='"+c+"'],textarea[name='"+c+"']"),e=jQuery(d).closest("div.field");"hidden"===d.attr("type")||e.hasClass(a.classForUncompletedField)||(e.removeClass("show").addClass("hide"),e.find("select[required='required'], input[required='required'], textarea[required='required']").each(function(a,c){jQuery(c).attr("data-has-required","yes").removeAttr("required");b=!0}))}a.entryFieldHolder.is(":visible")&&b?(a.entryField.attr("required",
"required"),a.entryFieldHolder.attr("required","required")):(a.entryField.removeAttr("required"),a.entryFieldHolder.removeAttr("required"))}},alreadyHasValues:function(){var b=0,c=0,d;for(d in a.relatedFields){var e=jQuery("input[name='"+d+"'],select[name='"+d+"'],textarea[name='"+d+"']"),e=jQuery(e).closest("div.field");jQuery(e).find("select, input, textarea").each(function(a,d){c++;""!=jQuery(d).val()&&0!=jQuery(d).val()||b++})}return b/c<=a.percentageToBeCompleted?!0:!1},clearFields:function(){for(var b in a.relatedFields)jQuery("#"+
b).find("select, input, textarea").val("")},setResults:function(b){return a.entryField.attr("data-has-result",b)},hasResults:function(){return"yes"==a.entryField.attr("data-has-result")?!0:!1},updateEntryFieldStatus:function(){var b=a.entryField.val(),c=a.hasResults(),b=1<b.length;c?(a.entryField.addClass(a.selectedClass),a.entryField.removeClass(a.useMeClass),a.entryFieldHolder.find(a.viewGoogleMapLinkSelector).show(),a.entryFieldHolder.find(a.bypassSelector).hide()):(a.entryField.removeClass(a.selectedClass),
a.entryField.addClass(a.useMeClass),a.entryFieldHolder.find(a.viewGoogleMapLinkSelector).hide(),a.entryFieldHolder.find(a.bypassSelector).show());b?a.entryField.addClass(a.hasTextClass):a.entryField.removeClass(a.hasTextClass)},getStaticMapImage:function(b){if(a.googleStaticMapLink){var c=a.googleStaticMapLink,c=c.replace("[ADDRESS]",b,"gi"),c=c.replace("[ADDRESS]",b,"gi"),c=c.replace("[ADDRESS]",b,"gi");b=a.entryFieldHolder.find("input").outerWidth();b||(b=a.defaultWidthOfStaticImage);b&&(c=c.replace("[MAXWIDTH]",
b,"gi"),c=c.replace("[MAXWIDTH]",b,"gi"));b||(b=a.defaultHeightOfStaticImage);b&&(c=c.replace("[MAXHEIGHT]",b,"gi"),c=c.replace("[MAXHEIGHT]",b,"gi"));return c}},loadDefaultAddress:function(){var a=this,c=new google.maps.Geocoder,d={};d.address=a.defaultAddress;c.geocode(d,function(c,d){d==google.maps.GeocoderStatus.OK&&0<c.length&&a.fillInAddress(c[0])})}};return{getVar:function(b){if(a.hasOwnProperty(b))return a[b]},setVar:function(b,c){for(var d in a)a.hasOwnProperty(d)&&d.toLowerCase()==b&&(a[d]=
c);return this},init:function(){a.init();return this}}};
